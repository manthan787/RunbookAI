# Changes - 2026-02-08

## Summary
This update moved key roadmap items from design into runtime behavior.

## Implemented
- Runtime skill execution is now active through the `skill` tool.
- Runtime skill list in CLI is now dynamic (skill registry + user skills).
- Agent runtime now has a knowledge retriever wired in by default.
- Incident config parity added for OpsGenie (`incident.opsgenie`).
- Kubernetes is now a first-class, read-only operational tool surface.
- Kubernetes tool loading is now gated by init/config (`providers.kubernetes.enabled`).

## Technical Details

### 1) Skill execution wiring
- File: `src/tools/registry.ts`
- Change: `skill` tool now:
  - Loads user skills via `skillRegistry.loadUserSkills()`.
  - Constructs `SkillExecutor` and executes the selected skill.
  - Uses approval callback for `requiresApproval` steps.
  - Returns execution metadata, per-step status, duration, and errors.

### 2) CLI runtime wiring
- File: `src/cli.tsx`
- Change:
  - Added runtime agent factory that loads dynamic skills from registry.
  - Added runtime knowledge retriever adapter and passed it to `Agent`.
  - Applied same runtime path to both TTY and non-TTY execution.

### 3) OpsGenie config parity
- File: `src/utils/config.ts`
- Change:
  - Added `OpsGenieConfigSchema` to `IncidentConfigSchema`.
  - Added validation error when OpsGenie is enabled but key is missing.

### 4) Kubernetes tooling
- File: `src/tools/registry.ts`
- Change:
  - Added `kubernetes_query` tool using `createKubernetesClient`.
  - Supported actions:
    - `status`, `contexts`, `namespaces`, `pods`, `deployments`, `nodes`, `events`, `top_pods`, `top_nodes`
  - Registered `kubernetes` tool category.

### 5) Kubernetes onboarding + runtime gating
- Files:
  - `src/config/onboarding.ts`
  - `src/cli/setup-wizard.tsx`
  - `src/utils/config.ts`
  - `src/cli/runtime-tools.ts`
  - `src/cli.tsx`
- Change:
  - Added a dedicated Kubernetes question in setup wizard.
  - Persisted `providers.kubernetes.enabled` in `.runbook/config.yaml`.
  - Runtime tool list now filters out `kubernetes_query` when Kubernetes is disabled.

## Validation
- `npm run typecheck`: passed
- `npm run test`: passed (8 test files, 241 tests)
- Runtime gating smoke query: passed (`kubernetes_query` only loaded when enabled)
